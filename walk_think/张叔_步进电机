170618：
需求：
	用旋转编码器调节档次，在每个档次步进电机转的转不同的步数来带动纸移动，
	一共设6档，旋转编码器调档，一个七段数码管显示档数，旋转编码开关按键触发电机转动，


电路：蓝牙模块、旋转编码开关、调试串口（USART1）接好了，
	  步进电机虽然接了，但是旋转编码开关使用了TIM3，电机两个IO口接到PB0,PB1,也是TIM3的，无法同时使用，


软件：
1、旋转编码开关驱动使用之前跳的（非常感谢有清给的代码），还有问题，转多几下，会出现错误，
	问题：
		1、为什么会出错？
		2、定时器驱动编码器的原理？


2、存储每档转的步数及圈数
	1、把STM32内部flash用作EPPROM
	2、每档存储格式：一共3字节：
		第一个字节存圈数，第二跟第三存步数
		6档：一共要3X6=18个字节保存有效数据，
		存储方式：AA+长度+有效数据+校验+AA 一共22字节
	3、因为这数据不用频繁改动，所以不用考虑flash寿命的问题，只要固定一些来保存，



	问题：
		STM32内部flash当作EEPROM使用如何操作，如何读（按页？按字节？），如何写（按页？按字节？），擦除方式？
		写：word | halfword 页擦除
	使用：
		操作流程：
		读：解锁->擦除(扇区擦除）->写->锁保护
		写的方式有：word | halfword,不同型号的芯片有不同的写入方式，有且只有一种（只支持一种写法）
		一开始从网上找的代码是word写入，一直调都调不出来，只要一些就触发HardFault_Handler，然后改为halfword就可以通过了，

		读：解锁->读（word | halfword)->锁保护
		在调读的时候又出现了HardFault_Handler，同样也是字节数的问题，网上找的代码也是word方式读，又被这个问题搞了很久，为什么就不会想到这跟写的时候碰到的问题一样呢？

		由于STM32 flash 读跟写都是word | halfword,如果要转成字节的话，就涉及到大端小端的问题，

问题：
在调读写flash过程中，出现过很多次HardFault_Handler，HardFault_Handler是什么？可以怎么处理？
	M3内核说明中有关异常处理，
	网上找到的一个处理方式：
		void HardFault_Handler(void)  
		{  
		  uint32_t r_sp ;  
		  
		  r_sp = __get_PSP(); //获取SP的值  
		  PERROR(ERROR,Memory Access Error!);  
		  Panic(r_sp);  
		   
		  while (1);  
		}  


3、PWM，驱动电机
timer设置为单次PWM输出，然后控制固定个PWM输出来控制电机转动，
问题：
	1、如何实现，

4、整体逻辑：



5、突然想到，为什么还要弄个蓝牙跟APP，通过手机来调试&设置每个档次的步数呢，这样物料成本就搞了，也还要花时间写个APP；
	解决方案还有一个：
		有两个工作模式：
			1、调试模式，可用于调试（测出每个档次的步数圈数），并保存，
			2、工作模式，仅仅用于驱动步进电机，
不过，这个算法就复杂了点，

实现：
用个跳线帽，选择不同的工作方式，
1、调试模式：
模式：
数码管小数点只是工作状态：
常亮表示：档数选择，转动编码快关，调节档数，
闪烁表示：在调节step,转动编码快关，电机转动，并记录转动step,
通过编码开关按键选择选择档数，还是调节档数，


初始化：
档数，数码管，小数点，步进电机圈数&步数，
开机：档数选择，数码管显示1（要调节的档数）,小数点常亮,转动编码开关，调节档数，
选定档数，按编码开关，进行调节step,调节完，再次按编码开关，保存所调节档数，并进入档数选择模式，

2、工作模式：
工作：旋转编码开关选择gears,按键触发电机转动，
初始化：
1、读取数据，
2、初始化变量，



